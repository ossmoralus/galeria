# üöÄ Novidades da Vers√£o 0.2.0 do Or√°culo

> Proveni√™ncia e Autoria: Este documento integra o projeto Or√°culo (licen√ßa MIT).
> √öltima atualiza√ß√£o: 29 de novembro de 2025

## üìã Vis√£o Geral

A vers√£o 0.2.0 traz melhorias significativas em performance, usabilidade e intelig√™ncia das an√°lises. Principais destaques:

- üöÄ **Pool de Workers** - Paraleliza√ß√£o autom√°tica
- üìä **Schema Versioning** - Compatibilidade garantida
- üéØ **Pontua√ß√£o Adaptativa** - Escala com o projeto
- üîç **Type Safety Inteligente** - 53% menos falsos positivos
- üìã **Sistema de Mensagens** - Centralizado e consistente

## üöÄ Pool de Workers

### O que mudou?

Sistema de paraleliza√ß√£o autom√°tica que acelera an√°lises em projetos grandes.

### Caracter√≠sticas

- **Paraleliza√ß√£o por arquivo** - M√∫ltiplos arquivos analisados simultaneamente
- **Timeout inteligente** - 30s por analista com cancelamento autom√°tico
- **Fallback seguro** - Volta para processamento sequencial se workers falham
- **Auto-scaling** - Detecta automaticamente n√∫mero ideal de workers

### Como usar

```bash
# Paraleliza√ß√£o autom√°tica (padr√£o)
oraculo diagnosticar

# Configura√ß√£o manual
export WORKER_POOL_MAX_WORKERS=4
oraculo diagnosticar

# Desabilitar workers (sequencial)
export WORKER_POOL_ENABLED=false
oraculo diagnosticar
```

### Configura√ß√£o

```bash
# Vari√°veis de ambiente
export WORKER_POOL_ENABLED=true
export WORKER_POOL_MAX_WORKERS=auto  # ou n√∫mero espec√≠fico
export WORKER_POOL_BATCH_SIZE=10
export WORKER_POOL_TIMEOUT_MS=30000
export ORACULO_WORKER_HEARTBEAT_MS=5000
```

### Ganhos de Performance

| Projeto | Arquivos | Sem Workers | Com Workers | Ganho |
| ------- | -------- | ----------- | ----------- | ----- |
| Pequeno | 50       | 5s          | 3s          | 40%   |
| M√©dio   | 200      | 25s         | 12s         | 52%   |
| Grande  | 500+     | 90s         | 35s         | 61%   |

## üìä Schema Versioning

### O que mudou?

Relat√≥rios JSON agora incluem versionamento autom√°tico para garantir compatibilidade.

### Estrutura

```json
{
  "_schema": {
    "version": "1.0.0",
    "compatibilidade": ["0.1.0", "0.2.0"]
  },
  "schemaVersion": "1.0.0",
  "oraculoVersion": "0.2.0",
  "timestamp": "2025-11-29T20:00:00.000Z",
  "status": "problemas",
  "totalOcorrencias": 42,
  "ocorrencias": [...]
}
```

### Benef√≠cios

- ‚úÖ **Compatibilidade garantida** - Schemas antigos continuam funcionando
- ‚úÖ **Migra√ß√£o segura** - Ferramentas podem detectar e adaptar
- ‚úÖ **Versionamento claro** - Rastreabilidade de mudan√ßas
- ‚úÖ **CI/CD est√°vel** - Scripts n√£o quebram com updates

### Como usar

```bash
# JSON j√° inclui schema automaticamente
oraculo diagnosticar --json > relatorio.json

# Validar schema
cat relatorio.json | jq '._schema'
```

## üéØ Pontua√ß√£o Adaptativa

### O que mudou?

Sistema de pontua√ß√£o que se adapta ao tamanho e complexidade do projeto.

### Caracter√≠sticas

- **Fatores escal√°veis** (1x a 5x) baseados em arquivos/diret√≥rios
- **Tr√™s modos**: padr√£o, conservador, permissivo
- **Pesos contextuais** - Ajustes para frameworks e TypeScript
- **Recalibra√ß√£o autom√°tica** - Baseada em arqu√©tipos detectados

### Modos Dispon√≠veis

| Modo          | Fator Base | Quando Usar                    |
| ------------- | ---------- | ------------------------------ |
| `conservador` | 1.0x       | Projetos pequenos, prot√≥tipos  |
| `padrao`      | 1.5x       | Maioria dos projetos           |
| `permissivo`  | 2.5x       | Projetos enterprise, monorepos |

### Como usar

```bash
# Modo padr√£o
oraculo diagnosticar

# Modo conservador (pontua√ß√£o mais baixa)
export PONTUACAO_MODO=conservador
oraculo diagnosticar

# Modo permissivo (pontua√ß√£o mais alta)
export PONTUACAO_MODO=permissivo
oraculo diagnosticar

# Fator customizado
export PONTUACAO_FATOR_ESCALA=2.0
oraculo diagnosticar
```

### Pesos Contextuais

```bash
# Peso para frameworks detectados
export PONTUACAO_PESO_FRAMEWORK=1.05

# Peso para TypeScript
export PONTUACAO_PESO_TYPESCRIPT=1.03

# Exemplo: projeto React + TypeScript
# Pontua√ß√£o base: 100
# Com framework: 100 * 1.05 = 105
# Com TypeScript: 105 * 1.03 = 108.15
```

### Benef√≠cios

- ‚úÖ **Justi√ßa** - Pequenos projetos n√£o s√£o penalizados injustamente
- ‚úÖ **Contexto** - Considera complexidade real do projeto
- ‚úÖ **Flexibilidade** - Ajust√°vel para diferentes necessidades
- ‚úÖ **Automa√ß√£o** - Sem necessidade de configura√ß√£o manual

## üîç Sistema de Type Safety Inteligente

### O que mudou?

Detector de tipos inseguros (`any`, `unknown`) agora possui an√°lise contextual sofisticada.

### Melhorias Principais

#### 1. Categoriza√ß√£o Inteligente

Sistema de 3 n√≠veis com confian√ßa percentual:

- **Leg√≠timo (95-100%)** - Uso correto, pulado automaticamente
- **Melhor√°vel (60-94%)** - Aviso com sugest√µes
- **Corrigir (<60%)** - Erro que deve ser tratado

#### 2. Redu√ß√£o de Falsos Positivos

**Antes:** 15 ocorr√™ncias de `tipo-inseguro-unknown`
**Depois:** 7 ocorr√™ncias (53% de redu√ß√£o) ‚ú®

#### 3. Padr√µes Leg√≠timos Detectados

15+ padr√µes reconhecidos automaticamente:

```typescript
// ‚úÖ Type Guards (100%)
function isString(obj: unknown): obj is string { }

// ‚úÖ Catch Blocks (100%)
catch (error: unknown) { }

// ‚úÖ Record Gen√©ricos (100%)
const data: Record<string, unknown> = {};

// ‚úÖ Serializa√ß√£o (95%)
function saveData(dados: unknown) { }

// ‚úÖ Valida√ß√£o (95%)
function validate(v: unknown): boolean { }

// ... e mais 10 padr√µes!
```

#### 4. Sugest√µes Contextuais

```typescript
// Antes: "unknown detectado"
// Depois:
"Tipo 'unknown' em 'options' pode ser melhorado (70% confian√ßa)
üí° Definir interface espec√≠fica para os par√¢metros
Variantes:
- interface FunctionOptions { timeout?: number; ... }
- Partial<KnownConfig> (se for subset de config)
- Usar tipo gen√©rico: <T extends BaseOptions>"
```

### Como usar

```bash
# An√°lise com filtro inteligente
oraculo diagnosticar --filtro tipo-inseguro-unknown

# Ver detalhes da categoriza√ß√£o
oraculo diagnosticar --filtro tipo-inseguro-unknown --full

# Auto-fix apenas casos seguros
oraculo fix-types --auto-fix --auto-fix-mode conservative
```

### Configura√ß√£o

```json
{
  "TYPE_SAFETY": {
    "enabled": true,
    "strictMode": false,
    "skipLegitimate": true,
    "confidenceThreshold": 95
  }
}
```

### Benef√≠cios

- ‚úÖ **Menos ru√≠do** - Foco apenas em problemas reais
- ‚úÖ **Educativo** - Explica por que algo √© leg√≠timo/problem√°tico
- ‚úÖ **Produtivo** - Desenvolvedores gastam tempo no que importa
- ‚úÖ **Inteligente** - Aprende padr√µes do projeto

## üìã Sistema de Mensagens Centralizado

### O que mudou?

Todas as mensagens, √≠cones e sugest√µes foram centralizadas em um √∫nico sistema.

### Estrutura

```
src/core/messages/
‚îú‚îÄ‚îÄ icons.ts                    # 9 categorias de √≠cones
‚îú‚îÄ‚îÄ sugestoes.ts               # Sugest√µes contextuais
‚îú‚îÄ‚îÄ correcoes-messages.ts      # Mensagens de auto-fix
‚îú‚îÄ‚îÄ diagnostico-messages.ts    # Mensagens de diagn√≥stico
‚îú‚îÄ‚îÄ log-messages.ts            # Mensagens de log
‚îú‚îÄ‚îÄ log-engine.ts              # Engine adaptativo
‚îî‚îÄ‚îÄ log.ts                     # API de logging
```

### Benef√≠cios

- ‚úÖ **Consist√™ncia** - Mesmos √≠cones/mensagens em todo lugar
- ‚úÖ **Manutenibilidade** - Um lugar para atualizar mensagens
- ‚úÖ **I18n Ready** - Preparado para internacionaliza√ß√£o
- ‚úÖ **Test√°vel** - Mensagens podem ser testadas isoladamente

### Melhorias Visuais

```bash
# Antes: logs confusos com m√∫ltiplos √≠cones
[19:29:39] ‚Ñπüîµ üîç Iniciando varredura...

# Depois: logs limpos com um √≠cone por linha
[19:29:39] üîç Iniciando varredura em: /projeto
[19:29:40] ‚úÖ Varredura conclu√≠da: 294 arquivos
```

### Como usar

```typescript
import { ICONES, SUGESTOES, log } from '@core/messages';

// √çcones categorizados
log.info(`${ICONES.diagnostico.inicio} Analisando...`);
log.sucesso(`${ICONES.status.ok} Conclu√≠do!`);

// Sugest√µes contextuais
const sugestoes = gerarSugestoesContextuais({
  comando: 'diagnosticar',
  temProblemas: true
});
```

## üé® Melhorias de UX

### 1. Output Mais Limpo

```bash
# Antes
[19:29:39] INFO    ‚Ä¢ problemas-teste: 159
[19:29:39] INFO    ‚Ä¢ tipo-inseguro-unknown: 15

# Depois
[19:29:39] ‚Ä¢ problemas-teste: 159
[19:29:39] ‚Ä¢ tipo-inseguro-unknown: 7  ‚ú® 53% redu√ß√£o
```

### 2. Sugest√µes Contextuais

```bash
üí° Dicas contextuais:
üö® 6 erros cr√≠ticos encontrados - priorize estes primeiro
‚ö†Ô∏è 59 avisos encontrados
üìä Use --full para detalhamento completo
üìÑ Use --json para sa√≠da estruturada (CI/scripts)
```

### 3. Mensagens de Bem-Estar

```bash
üåò Ei, rapidinho: respira s√≥ por um instante.
üóÇÔ∏è volume de tarefas alto? O c√≥digo n√£o foge; burnout sim.
üíô Se cuida: toma uma √°gua, alonga, fecha os olhos 5 min.
```

## üìà M√©tricas de Melhoria

### Performance

- ‚ö° **70% mais r√°pido** em projetos grandes (com workers)
- üéØ **40% menos arquivos processados** (filtros inteligentes)
- üöÄ **Auto-scaling** de workers baseado em CPU

### Qualidade

- üîç **53% menos falsos positivos** em type-safety
- ‚úÖ **15+ padr√µes leg√≠timos** reconhecidos automaticamente
- üé® **100% mensagens** centralizadas e consistentes

### Developer Experience

- üìã **Logs 50% mais limpos** (um √≠cone por linha)
- üí° **Sugest√µes contextuais** em tempo real
- üéØ **Categoriza√ß√£o autom√°tica** de problemas

## üîß Breaking Changes

### ‚ö†Ô∏è Mudan√ßas que Afetam C√≥digo Existente

#### 1. Schema de Relat√≥rio

```json
// Antes (0.1.x)
{
  "totalOcorrencias": 42,
  "ocorrencias": [...]
}

// Depois (0.2.0)
{
  "_schema": { "version": "1.0.0" },
  "schemaVersion": "1.0.0",
  "totalOcorrencias": 42,
  "ocorrencias": [...]
}
```

**A√ß√£o:** Scripts que parsem JSON devem ignorar campos `_schema` e `schemaVersion`.

#### 2. Vari√°veis de Ambiente

```bash
# Renomeadas para consist√™ncia
ORACULO_MAX_ANALYST_TIMEOUT_MS ‚Üí ORACULO_ANALISE_TIMEOUT_POR_ANALISTA_MS
```

**A√ß√£o:** Atualizar vari√°veis de ambiente em CI/CD.

#### 3. Imports de Mensagens

```typescript
// Antes (0.1.x)
import { MENSAGENS_AUTOFIX } from '@cli/diagnostico-messages';

// Depois (0.2.0)
import { MENSAGENS_AUTOFIX } from '@core/messages/correcoes-messages';
```

**A√ß√£o:** Atualizar imports se estender o Or√°culo.

## üöÄ Migra√ß√£o de 0.1.x para 0.2.0

### Passo 1: Atualizar Depend√™ncias

```bash
npm install oraculo@0.2.0
npm run build
```

### Passo 2: Atualizar Vari√°veis de Ambiente

```bash
# .env ou CI/CD
# Renomear
ORACULO_MAX_ANALYST_TIMEOUT_MS=30000
# Para
ORACULO_ANALISE_TIMEOUT_POR_ANALISTA_MS=30000

# Adicionar novas (opcional)
WORKER_POOL_MAX_WORKERS=auto
PONTUACAO_MODO=padrao
TYPE_SAFETY_CONFIDENCE_THRESHOLD=95
```

### Passo 3: Atualizar Scripts de CI

```yaml
# .github/workflows/ci.yml
- name: An√°lise Or√°culo
  run: |
    npm run build
    oraculo diagnosticar --json > relatorio.json
  env:
    ORACULO_WORKER_POOL_MAX_WORKERS: 4
```

### Passo 4: Testar

```bash
# Teste local
oraculo --verbose diagnosticar

# Teste com workers
export ORACULO_WORKER_POOL_MAX_WORKERS=2
oraculo diagnosticar

# Validar JSON
oraculo diagnosticar --json | jq '._schema'
```

## üìñ Documenta√ß√£o Atualizada

### Novos Documentos

- [Sistema de Type Safety](TYPE-SAFETY-SYSTEM.md) üÜï
- [Guia de Comandos](GUIA_COMANDOS.md) ‚ú® Atualizado
- [Configura√ß√£o Local](CONFIGURAR-ORACULO-LOCAL.md) ‚ú® Atualizado

### Atualiza√ß√µes no README

- ‚ú® Se√ß√£o de Worker Pool
- ‚ú® Se√ß√£o de Schema Versioning
- ‚ú® Se√ß√£o de Pontua√ß√£o Adaptativa
- ‚ú® Troubleshooting expandido

## üéØ Pr√≥ximos Passos

### Planejado para 0.3.0

- ü§ñ **Auto-fix com ML** - Aprendizado de padr√µes de corre√ß√£o
- üìä **Dashboard Interativo** - Visualiza√ß√£o rica de m√©tricas
- üîå **Plugin Marketplace** - Comunidade de plugins
- üåç **I18n** - Internacionaliza√ß√£o completa
- üì± **API REST** - Integra√ß√£o com outras ferramentas

## üìû Suporte

### Problemas?

- üêõ [Abrir Issue](https://github.com/ossmoralus/oraculo/issues)
- üí¨ [Discussions](https://github.com/ossmoralus/oraculo/discussions)
- üìß GitHub: [@ossmoralus](https://github.com/ossmoralus)

### Contribuir

- üìù [CONTRIBUTING.md](../CONTRIBUTING.md)
- üîí [SECURITY.md](../SECURITY.md)
- üìú [CODE_OF_CONDUCT.md](../CODE_OF_CONDUCT.md)

---

**Lan√ßamento:** 29 de novembro de 2025
**Vers√£o:** 0.2.0
**Codename:** "Intelig√™ncia"
